---
import "katex/dist/katex.min.css";

import { format } from "date-fns";
import { Icon } from "astro-icon";

import MarkdownPostLayout from "../../layouts/MarkdownPostLayout.astro";
import { getCollection, type CollectionEntry } from "astro:content";

import { slugToPath } from "../../libs/blog";
import siteMeta from "../../siteMeta";

interface Props {
  slug: string;
  entry: CollectionEntry<"blog">;
}

export async function getStaticPaths() {
  const blogEntries = await getCollection("blog");
  return blogEntries
    .filter((entry) => !entry.data.draft)
    .map((entry) => {
      const slug = slugToPath(entry.slug);
      return {
        params: { slug },
        props: { slug, entry },
      };
    });
}

const { slug, entry } = Astro.props;
const { Content } = await entry.render();
---

<MarkdownPostLayout title={`${entry.data.title} | ${siteMeta.siteName}`}>
  <div class="mb-6">
    <h1 class="flex py-0 my-1 justify-center">
      <a class="no-underline" href={`/blog/${slug}`}> {entry.data.title}</a>
    </h1>
    <div class="flex justify-center items-center my-2">
      <Icon name="mdi:calendar" size={21} />
      <p class="my-0 p-0 ml-1 indent-0">
        {format(entry.data.created_at, "yyyy/MM/dd")}
      </p>
    </div>
    <ul class="flex flex-wrap list-none justify-center">
      {
        entry.data.tags.map((tag) => (
          <>
            <li
              class="flex gap-1 mx-1 my-1 px-2 py-1
                     items-center
                     text-sm
                     border border-black rounded-full
                     after:content-['']"
            >
              <Icon name="mdi:tag" size={16} />
              {tag}
            </li>
          </>
        ))
      }
    </ul>
  </div>
  <div class="markdown">
    <Content />
  </div>
</MarkdownPostLayout>
